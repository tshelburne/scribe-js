(function(){var j=window.modules||[],a=null;j.scribe__datastore=function(){if(null===a){var g,c,h,b;g=require("scribe/repositories/entity_constructor_map");c=require("scribe/repositories/entity_container");h=require("scribe/factory/entity_factory");b=require("scribe/factory/reference_builder");var e=function(b,d){this.entityFactory=b;this.entityContainer=d};e.create=function(f,d,k){var e,a;null==d&&(d=[]);null==k&&(k={});e=new c;d=new this(new h(new b(e),f,d),e);for(a in k)f=k[a],d.registerConstructor(a,
f);return d};e.prototype.registerConstructor=function(b,d){return g.link(b,d)};e.prototype.buildEntity=function(b,d){return this.entityContainer.add(this.entityFactory.build(b,d))};e.prototype.buildEntities=function(b,d){var e,a,c,h;h=[];a=0;for(c=d.length;a<c;a++)e=d[a],h.push(this.buildEntity(b,e));return h};e.prototype.getRepository=function(b){return this.entityContainer.getRepository(b)};e.prototype.find=function(b,d){return this.entityContainer.find(b,d)};a=e}return a};window.modules=j})();
(function(){var j=window.modules||[],a=null;j.scribe__factory__auto_mapper=function(){if(null===a){var g;g=require("scribe/repositories/entity_constructor_map");var c=function(d,b){this.entityClass=d;this.referenceBuilder=null!=b?b:null},h,b,e,f;c.prototype.canHandle=function(b){return g.match(b,this.entityClass)};c.prototype.handle=function(b){var e;e=f.call(this,b);"function"===typeof this.buildEntity&&this.buildEntity(b,e);this.referenceBuilder.hydrateReferencesFor(e);return e};f=function(d){var f,
a,c,g;f=new this.entityClass(d.id);for(a in d)g=d[a],h(f,a)&&(e(g)?this.referenceBuilder.createReference(f,a,g["class"],g.id):b(g)?(c="id"in g?g.id:g.ids,this.referenceBuilder.createReferenceCollection(f,a,g["class"],c)):f[a]=g);return f};h=function(b,e){return e in b&&!(b[e]instanceof Function)};e=function(b){return b instanceof Object&&"class"in b&&"id"in b&&!(b.id instanceof Array)};b=function(b){return b instanceof Object&&"class"in b&&("ids"in b||"id"in b&&b.id instanceof Array)};a=c}return a};
window.modules=j})();
(function(){var j=window.modules||[],a=null;j.scribe__factory__entity_factory=function(){if(null===a){var g;g=require("scribe/factory/auto_mapper");var c=function(b,e,f){var d,a;this.referenceBuilder=b;null==f&&(f=[]);d=0;for(a=e.length;d<a;d++)b=e[d],h(b)&&(b.referenceBuilder=this.referenceBuilder);this.mappers=e;b=0;for(d=f.length;b<d;b++)e=f[b],this.mappers.push(new g(e,this.referenceBuilder))},h;c.prototype.build=function(b,e){var a,d,c,h;h=this.mappers;d=0;for(c=h.length;d<c;d++)if(a=h[d],a.canHandle(b))return a.handle(e);
return null};h=function(b){return b instanceof g&&null==b.referenceBuilder};a=c}return a};window.modules=j})();
(function(){var j=window.modules||[],a=null;j.scribe__factory__reference_builder=function(){if(null===a){var g;g=require("scribe/repositories/entity_constructor_map");var c=function(b){this.entityContainer=b;this.pendingReferences=[]},h,b,e,f,d,j,l,n,p;c.prototype.createReference=function(b,a,f,c){var h;h=d.call(this,f,c);return null!=h?b[a]=h:e.call(this,b,a,f,c)};c.prototype.createReferenceCollection=function(a,f,c,h){var g,j,k,l,m;m=[];k=0;for(l=h.length;k<l;k++)g=h[k],j=d.call(this,c,g),null!=
j?m.push(b(a,f,j)):m.push(e.call(this,a,f,c,g,!0));return m};c.prototype.hydrateReferencesFor=function(b){var a,e,d,c,h;a=f.call(this,b);h=[];d=0;for(c=a.length;d<c;d++)e=a[d],n(e,b),h.push(l.call(this,e));return h};d=function(b,a){var e;return null!=(e=this.entityContainer.getRepository(b))?e.find(a):void 0};e=function(b,a,e,d,f){null==f&&(f=!1);return this.pendingReferences.push(new h(b,a,e,d,f))};f=function(b){var a,e,d,f,h;f=this.pendingReferences;h=[];e=0;for(d=f.length;e<d;e++)a=f[e],j(a,b)&&
h.push(a);return h};l=function(b){return this.pendingReferences.splice(this.pendingReferences.indexOf(b),1)};j=function(b,e){return g.match(b.refClass,e.constructor)&&b.refId===e.id};n=function(e,a){return e.partOfCollection?b(e.entity,e.prop,a):e.entity[e.prop]=a};b=function(b,e,a){var d;d=p(e);return null!=b["addTo"+d]?b["addTo"+d](a):b[e].push(a)};p=function(b){return""+b.charAt(0).toUpperCase()+b.slice(1)};h=function(b,e,a,d,f){this.entity=b;this.prop=e;this.refClass=a;this.refId=d;this.partOfCollection=
null!=f?f:!1};a=c}return a};window.modules=j})();(function(){var j=window.modules||[],a=null;j.scribe__repositories__entity_constructor_map=function(){if(null===a){var g=function(){},c;g.ctors={};g.link=function(a,b){return this.ctors[a]=b};g.find=function(a){return this.ctors[a]};g.match=function(a,b){return null!=this.find(a)?this.find(a)===b:c(b)===a};c=function(a){a=/function (.{1,})\(/.exec(a.toString());return null!=a&&1<a.length?a[1]:""};a=g}return a};window.modules=j})();
(function(){var j=window.modules||[],a=null;j.scribe__repositories__entity_container=function(){if(null===a){var g;g=require("scribe/repositories/entity_repository");var c=function(){this.repositories=[]},h;c.prototype.add=function(b){var a;a=this.getRepository(b);null==a&&(a=h.call(this,b));return a.add(b)};c.prototype.find=function(b,a){var f;f=this.getRepository(b);return null!=f?f.find(a):null};c.prototype.getRepository=function(b){var a,f,d,c;c=this.repositories;f=0;for(d=c.length;f<d;f++)if(a=
c[f],a.canHandle(b))return a;return null};h=function(b){b=new g(b.constructor);this.repositories.push(b);return b};a=c}return a};window.modules=j})();
(function(){var j=window.modules||[],a=null;j.scribe__repositories__entity_repository=function(){if(null===a){var g;g=require("scribe/repositories/entity_constructor_map");var c=function(b){this.entityClass=b;this.entityList=[]},h;c.prototype.canHandle=function(b){return this.entityClass===b||g.match(b,this.entityClass)||b.constructor===this.entityClass};c.prototype.add=function(b){return this.entityList.push(b)};c.prototype.remove=function(b){return this.entityList.splice(this.entityList.indexOf(b),
1)};c.prototype.find=function(b){var a,f,d,c;c=this.entityList;f=0;for(d=c.length;f<d;f++)if(a=c[f],a.id===b)return a;return null};c.prototype.findAll=function(){return this.entityList};c.prototype.findBy=function(b){var a,f,d,c,g;c=this.entityList;g=[];f=0;for(d=c.length;f<d;f++)a=c[f],h(a,b)&&g.push(a);return g};c.prototype.findOneBy=function(b){var a,f,d,c;c=this.entityList;f=0;for(d=c.length;f<d;f++)if(a=c[f],h(a,b))return a;return null};c.prototype.numEntities=function(){return this.entityList.length};
h=function(a,e){var c,d;for(c in e)if(d=e[c],a[c]!==d)return!1;return!0};a=c}return a};window.modules=j})();(function(){var j=window.modules||[];window.require=function(a){a=a.replace(/\//g,"__");-1===a.indexOf("__")&&(a="__"+a);return null===j[a]?null:j[a]()}})();

