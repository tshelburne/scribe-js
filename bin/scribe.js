(function(){var a=window.modules||[],b=null;a.scribe__datastore=function(){if(null===b){var a,d;d=require("scribe/repositories/entity_repository");a=require("scribe/factory/entity_factory");var e=function(f){this.entityFactory=f;this.repos=[]};e["default"]=function(f){return new this(new a(f))};e.prototype.buildEntity=function(f,c,l){null==l&&(l=!0);this.getRepository(f).add(this.entityFactory.build(f,c));if(l)return this.rebuildReferences()};e.prototype.buildEntities=function(f,c,l){var d,e,b;null==
l&&(l=!0);e=0;for(b=c.length;e<b;e++)d=c[e],this.buildEntity(f,d,!1);if(l)return this.rebuildReferences()};e.prototype.rebuildReferences=function(){var f,c,e,d,b,a,g,u,v,w,p,x,j,h,y,m,n;m=this.repos;n=[];h=0;for(y=m.length;h<y;h++)j=m[h],0<j.numEntities()&&j.hasReferences()?(f=j.findAll(),n.push(function(){var h,k,n,s,q,m,r;r=[];h=0;for(n=f.length;h<n;h++)if(a=f[h],a.hydrated)r.push(void 0);else{x=0;q=j.metadata.references;k=0;for(s=q.length;k<s;k++)u=q[k],p=a[u],w=this.getRepository(p.entityType),
g=null!=w?w.find(p.entityId):null,null!=g&&(x++,a[u]=g);b=0;q=j.metadata.referenceCollections;k=0;for(s=q.length;k<s;k++){e=q[k];d=0;m=a[e];for(v in m)p=m[v],c=this.getRepository(p.entityType),g=null!=c?c.find(p.entityId):null,null!=g&&(d++,a[e][v]=g);d===a[e].length&&b++}x===j.numReferenceProperties()&&b===j.numReferenceCollections()?r.push(a.hydrated=!0):r.push(void 0)}return r}.call(this))):n.push(void 0);return n};e.prototype.getRepository=function(f){var c,e,b,a;a=this.repos;e=0;for(b=a.length;e<
b;e++)if(c=a[e],c.canHandle(f))return c;f=new d(f);this.repos.push(f);return f};e.prototype.find=function(e,c){return this.getRepository(e).find(c)};b=e}return b};window.modules=a})();(function(){var a=window.modules||[],b=null;a.scribe__factory__entity_factory=function(){if(null===b){var a=function(b){this.mappers=b};a.prototype.build=function(b,e){var f,c,a,g;g=this.mappers;c=0;for(a=g.length;c<a;c++)if(f=g[c],f.canHandle(b))return f.handle(e);return null};b=a}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__factory__entity_mapper=function(){if(null===b){var a=function(){this.type=null};a.prototype.canHandle=function(a){return a===this.type};a.prototype.handle=function(a){a=this.buildEntity(a);a.entityType=this.type;return a};a.prototype.buildEntity=function(){return alert("You must override the buildEntity() function to create a data mapper.")};b=a}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__factory__reference_property=function(){null===b&&(b=function(a,b){this.entityType=a;this.entityId=b});return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__repositories__entity_metadata=function(){if(null===b){var a=function(){this.isBuilt=!1;this.type="";this.properties=[];this.references=[];this.referenceCollections=[]},d;a.prototype.buildFromInstance=function(a){var b,c;this.type=a.entityType;for(b in a)c=a[b],c instanceof Array&&0<c.length&&d(c[0])?this.referenceCollections.push(b):d(c)?this.references.push(b):this.properties.push(b);return this.isBuilt=!0};a.prototype.hasReferences=function(){return 0<
this.references.length||0<this.referenceCollections.length};d=function(a){return a.hasOwnProperty("entityType")&&a.hasOwnProperty("entityId")};b=a}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__repositories__entity_repository=function(){if(null===b){var a;a=require("scribe/repositories/entity_metadata");var d=function(b){this.type=b;this.entityList=[];this.metadata=new a};d.prototype.canHandle=function(a){return this.type===a};d.prototype.hasReferences=function(){return this.metadata.hasReferences()};d.prototype.add=function(a){this.metadata.isBuilt||this.metadata.buildFromInstance(a);return this.entityList.push(a)};d.prototype.remove=
function(a){return this.entityList.splice(this.entityList.indexOf(a),1)};d.prototype.find=function(a){var b,c,d,g;g=this.entityList;c=0;for(d=g.length;c<d;c++)if(b=g[c],b.id===a)return b;return null};d.prototype.findAll=function(){return this.entityList};d.prototype.findBy=function(a){var b,c,d,g,t;c=[];t=this.entityList;d=0;for(g=t.length;d<g;d++)b=t[d],this.isMatch(b,a)&&c.push(b);return c};d.prototype.findOneBy=function(a){var b,c,d,g;g=this.entityList;c=0;for(d=g.length;c<d;c++)if(b=g[c],this.isMatch(b,
a))return b;return null};d.prototype.isMatch=function(a,b){var c,d;c=!0;for(d in b)c=c?a[d]===b[d]:!1;return c};d.prototype.numEntities=function(){return this.entityList.length};d.prototype.numReferenceProperties=function(){return this.metadata.references.length};d.prototype.numReferenceCollections=function(){return this.metadata.referenceCollections.length};b=d}return b};window.modules=a})();
(function(){var a=window.modules||[];window.require=function(b){b=b.replace(/\//g,"__");-1===b.indexOf("__")&&(b="__"+b);return null===a[b]?null:a[b]()}})();

