(function(){var a=window.modules||[],b=null;a.scribe__datastore=function(){if(null===b){var a,c;c=require("scribe/repositories/entity_repository");a=require("scribe/factory/entity_factory");var f=function(e){this.entityFactory=e;this.repos=[]};f["default"]=function(e){return new this(new a(e))};f.prototype.buildEntity=function(e,z,c){null==c&&(c=!0);this.getRepository(e).add(this.entityFactory.build(e,z));if(c)return this.rebuildReferences()};f.prototype.buildEntities=function(e,c,f){var b,a,d;null==
f&&(f=!0);a=0;for(d=c.length;a<d;a++)b=c[a],this.buildEntity(e,b,!1);if(f)return this.rebuildReferences()};f.prototype.rebuildReferences=function(){var e,c,f,b,a,d,n,u,v,w,p,x,j,h,y,l,m;l=this.repos;m=[];h=0;for(y=l.length;h<y;h++)j=l[h],0<j.numEntities()&&j.hasReferences()?(e=j.findAll(),m.push(function(){var h,k,m,s,q,l,r;r=[];h=0;for(m=e.length;h<m;h++)if(d=e[h],d.hydrated)r.push(void 0);else{x=0;q=j.metadata.references;k=0;for(s=q.length;k<s;k++)u=q[k],p=d[u],w=this.getRepository(p.entityType),
n=null!=w?w.find(p.entityId):null,null!=n&&(x++,d[u]=n);a=0;q=j.metadata.referenceCollections;k=0;for(s=q.length;k<s;k++){f=q[k];b=0;l=d[f];for(v in l)p=l[v],c=this.getRepository(p.entityType),n=null!=c?c.find(p.entityId):null,null!=n&&(b++,d[f][v]=n);b===d[f].length&&a++}x===j.numReferenceProperties()&&a===j.numReferenceCollections()?r.push(d.hydrated=!0):r.push(void 0)}return r}.call(this))):m.push(void 0);return m};f.prototype.getRepository=function(e){var f,b,a,d;d=this.repos;b=0;for(a=d.length;b<
a;b++)if(f=d[b],f.canHandle(e))return f;e=new c(e);this.repos.push(e);return e};f.prototype.find=function(c,f){return this.getRepository(c).find(f)};b=f}return b};window.modules=a})();(function(){var a=window.modules||[],b=null;a.scribe__factory__entity_factory=function(){if(null===b){var a=function(c){this.mappers=c};a.prototype.build=function(c,f){var b,a,d,g;g=this.mappers;a=0;for(d=g.length;a<d;a++)if(b=g[a],b.canHandle(c))return b.handle(f);return null};b=a}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__factory__entity_mapper=function(){if(null===b){var a=function(){this.type=null};a.prototype.canHandle=function(c){return c===this.type};a.prototype.handle=function(c){c=this.buildEntity(c);c.entityType=this.type;return c};a.prototype.buildEntity=function(){return alert("You must override the buildEntity() function to create a data mapper.")};b=a}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__factory__reference_property=function(){null===b&&(b=function(a,c){this.entityType=a;this.entityId=c});return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__repositories__entity_metadata=function(){if(null===b){var a=function(a){var b,e;this.type=a.entityType;this.properties=[];this.references=[];this.referenceCollections=[];for(b in a)e=a[b],e instanceof Array&&0<e.length&&this.isReference(e[0])?this.referenceCollections.push(b):this.isReference(e)?this.references.push(b):this.properties.push(b)};a.prototype.isReference=function(a){return a.hasOwnProperty("entityType")&&a.hasOwnProperty("entityId")};
a.prototype.hasReferences=function(){return 0<this.references.length||0<this.referenceCollections.length};b=a}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__repositories__entity_repository=function(){if(null===b){var a;a=require("scribe/repositories/entity_metadata");var c=function(a){this.type=a;this.entityList=[];this.metadata=null};c.prototype.canHandle=function(a){return this.type===a};c.prototype.hasReferences=function(){return this.metadata.hasReferences()};c.prototype.add=function(b){null==this.metadata&&(this.metadata=new a(b));return this.entityList.push(b)};c.prototype.remove=function(a){return this.entityList.splice(this.entityList.indexOf(a),
1)};c.prototype.find=function(a){var b,c,d,g;g=this.entityList;c=0;for(d=g.length;c<d;c++)if(b=g[c],b.id===a)return b;return null};c.prototype.findAll=function(){return this.entityList};c.prototype.findBy=function(a){var b,c,d,g,t;c=[];t=this.entityList;d=0;for(g=t.length;d<g;d++)b=t[d],this.isMatch(b,a)&&c.push(b);return c};c.prototype.findOneBy=function(a){var b,c,d,g;g=this.entityList;c=0;for(d=g.length;c<d;c++)if(b=g[c],this.isMatch(b,a))return b;return null};c.prototype.isMatch=function(a,b){var c,
d;c=!0;for(d in b)c=c?a[d]===b[d]:!1;return c};c.prototype.numEntities=function(){return this.entityList.length};c.prototype.numReferenceProperties=function(){return this.metadata.references.length};c.prototype.numReferenceCollections=function(){return this.metadata.referenceCollections.length};b=c}return b};window.modules=a})();(function(){var a=window.modules||[];window.require=function(b){b=b.replace(/\//g,"__");-1===b.indexOf("__")&&(b="__"+b);return null===a[b]?null:a[b]()}})();

