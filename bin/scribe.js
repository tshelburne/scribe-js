(function(){var b=window.modules||[],a=null;b.scribe__datastore=function(){if(null===a){var b,c;c=require("scribe/repositories/entity_repository");b=require("scribe/factory/entity_factory");var e=function(g){this.entityFactory=g;this.repos=[]};e["default"]=function(g){return new this(new b(g))};e.prototype.buildEntity=function(g,d,f){null==f&&(f=!0);this.getRepository(g).add(this.entityFactory.build(g,d));if(f)return this.rebuildReferences()};e.prototype.buildEntities=function(g,d,f){var c,a,e;null==
f&&(f=!0);a=0;for(e=d.length;a<e;a++)c=d[a],this.buildEntity(g,c,!1);if(f)return this.rebuildReferences()};e.prototype.rebuildReferences=function(){var g,d,f,a,c,e,b,h,t,u,p,v,k,j,w,m,n;m=this.repos;n=[];j=0;for(w=m.length;j<w;j++)k=m[j],0<k.numEntities()&&k.hasReferences()?(g=k.findAll(),n.push(function(){var j,l,n,s,q,m,r;r=[];j=0;for(n=g.length;j<n;j++)if(e=g[j],e.hydrated)r.push(void 0);else{v=0;q=k.metadata.references;l=0;for(s=q.length;l<s;l++)h=q[l],p=e[h],u=this.getRepository(p.entityType),
b=null!=u?u.find(p.entityId):null,null!=b&&(v++,e[h]=b);c=0;q=k.metadata.referenceCollections;l=0;for(s=q.length;l<s;l++){f=q[l];a=0;m=e[f];for(t in m)p=m[t],d=this.getRepository(p.entityType),b=null!=d?d.find(p.entityId):null,null!=b&&(a++,e[f][t]=b);a===e[f].length&&c++}v===k.numReferenceProperties()&&c===k.numReferenceCollections()?r.push(e.hydrated=!0):r.push(void 0)}return r}.call(this))):n.push(void 0);return n};e.prototype.getRepository=function(g){var d,e,a,b;b=this.repos;e=0;for(a=b.length;e<
a;e++)if(d=b[e],d.canHandle(g))return d;g=new c(g);this.repos.push(g);return g};e.prototype.find=function(e,d){return this.getRepository(e).find(d)};a=e}return a};window.modules=b})();(function(){var b=window.modules||[],a=null;b.scribe__factory__entity_factory=function(){if(null===a){var b=function(a){this.mappers=a};b.prototype.build=function(a,e){var g,d,b,h;h=this.mappers;d=0;for(b=h.length;d<b;d++)if(g=h[d],g.canHandle(a))return g.handle(e);return null};a=b}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__factory__entity_mapper=function(){if(null===a){var b=function(){this.type=null};b.prototype.canHandle=function(a){return a===this.type};b.prototype.handle=function(a){a=this.buildEntity(a);a.entityType=this.type;return a};b.prototype.buildEntity=function(){return alert("You must override the buildEntity() function to create a data mapper.")};a=b}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__references__reference_property=function(){null===a&&(a=function(a,b){this.entityType=a;this.entityId=b});return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__repositories__entity_metadata=function(){if(null===a){var b;b=require("scribe/references/reference_property");var c=function(){this.isBuilt=!1;this.type="";this.properties=[];this.references=[];this.referenceCollections=[]},e;c.prototype.buildFromInstance=function(a){var b,f;this.type=a.entityType;for(b in a)f=a[b],f instanceof Array&&0<f.length&&e(f[0])?this.referenceCollections.push(b):e(f)?this.references.push(b):this.properties.push(b);return this.isBuilt=
!0};c.prototype.hasReferences=function(){return 0<this.references.length||0<this.referenceCollections.length};e=function(a){return a instanceof b};a=c}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__repositories__entity_repository=function(){if(null===a){var b;b=require("scribe/repositories/entity_metadata");var c=function(a){this.type=a;this.entityList=[];this.metadata=new b};c.prototype.canHandle=function(a){return this.type===a};c.prototype.hasReferences=function(){return this.metadata.hasReferences()};c.prototype.add=function(a){this.metadata.isBuilt||this.metadata.buildFromInstance(a);return this.entityList.push(a)};c.prototype.remove=
function(a){return this.entityList.splice(this.entityList.indexOf(a),1)};c.prototype.find=function(a){var b,d,f,c;c=this.entityList;d=0;for(f=c.length;d<f;d++)if(b=c[d],b.id===a)return b;return null};c.prototype.findAll=function(){return this.entityList};c.prototype.findBy=function(a){var b,d,f,c,h;d=[];h=this.entityList;f=0;for(c=h.length;f<c;f++)b=h[f],this.isMatch(b,a)&&d.push(b);return d};c.prototype.findOneBy=function(a){var b,d,c,h;h=this.entityList;d=0;for(c=h.length;d<c;d++)if(b=h[d],this.isMatch(b,
a))return b;return null};c.prototype.isMatch=function(a,b){var d,c;d=!0;for(c in b)d=d?a[c]===b[c]:!1;return d};c.prototype.numEntities=function(){return this.entityList.length};c.prototype.numReferenceProperties=function(){return this.metadata.references.length};c.prototype.numReferenceCollections=function(){return this.metadata.referenceCollections.length};a=c}return a};window.modules=b})();
(function(){var b=window.modules||[];window.require=function(a){a=a.replace(/\//g,"__");-1===a.indexOf("__")&&(a="__"+a);return null===b[a]?null:b[a]()}})();

