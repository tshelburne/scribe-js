(function(){var a=window.modules||[],b=null;a.scribe__datastore=function(){if(null===b){var a,d;d=require("scribe/repositories/entity_repository");a=require("scribe/factory/entity_factory");var g=function(f){this.entityFactory=f;this.repos=[]};g.create=function(f){return new this(new a(f))};g.prototype.buildEntity=function(f,l,c){null==c&&(c=!0);this.getRepository(f).add(this.entityFactory.build(f,l));if(c)return this.rebuildReferences()};g.prototype.buildEntities=function(f,l,c){var e,b,d;null==
c&&(c=!0);b=0;for(d=l.length;b<d;b++)e=l[b],this.buildEntity(f,e,!1);if(c)return this.rebuildReferences()};g.prototype.rebuildReferences=function(){var f,l,c,b,d,a,g,s,t,u,n,q,h,j,m,v,k;v=this.repos;k=[];j=0;for(m=v.length;j<m;j++)h=v[j],0<h.numEntities()&&h.hasReferences()?(f=h.findAll(),k.push(function(){var k,p,z,j,r,v,m;m=[];k=0;for(z=f.length;k<z;k++)if(a=f[k],a.hydrated)m.push(void 0);else{q=0;r=h.metadata.references;p=0;for(j=r.length;p<j;p++)s=r[p],n=a[s],u=this.getRepository(n.entityClass),
g=null!=u?u.find(n.entityId):null,null!=g&&(q++,a[s]=g);d=0;r=h.metadata.referenceCollections;p=0;for(j=r.length;p<j;p++){c=r[p];b=0;v=a[c];for(t in v)n=v[t],l=this.getRepository(n.entityClass),g=null!=l?l.find(n.entityId):null,null!=g&&(b++,a[c][t]=g);b===a[c].length&&d++}q===h.numReferenceProperties()&&d===h.numReferenceCollections()?m.push(a.hydrated=!0):m.push(void 0)}return m}.call(this))):k.push(void 0);return k};g.prototype.getRepository=function(f){var b,c,e,a;a=this.repos;c=0;for(e=a.length;c<
e;c++)if(b=a[c],b.canHandle(f))return b;f=new d(f);this.repos.push(f);return f};g.prototype.find=function(f,b){return this.getRepository(f).find(b)};b=g}return b};window.modules=a})();(function(){var a=window.modules||[],b=null;a.scribe__factory__entity_factory=function(){if(null===b){var a=function(b){this.mappers=b};a.prototype.build=function(b,a){var f,l,c,e;e=this.mappers;l=0;for(c=e.length;l<c;l++)if(f=e[l],f.canHandle(b))return f.handle(a);return null};b=a}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__factory__entity_mapper=function(){if(null===b){var a=function(){this.entityClass=null};a.prototype.canHandle=function(b){return b===this.entityClass};a.prototype.handle=function(b){return this.buildEntity(b)};a.prototype.buildEntity=function(){return console.log("You must override the buildEntity() function to create a data mapper.")};b=a}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__references__reference_builder=function(){if(null===b){var a=function(){};a.prototype.rebuildReferences=function(){var b,a,f,l,c,e,w,s,x,y,t,u,n,q,h,j,m;j=this.repos;m=[];q=0;for(h=j.length;q<h;q++)n=j[q],0<n.numEntities()&&n.hasReferences()?(b=n.findAll(),m.push(function(){var j,k,m,p,h,q,r;r=[];j=0;for(m=b.length;j<m;j++)if(e=b[j],e.hydrated)r.push(void 0);else{u=0;h=n.metadata.references;k=0;for(p=h.length;k<p;k++)s=h[k],t=e[s],y=this.getRepository(t.entityType),
w=null!=y?y.find(t.entityId):null,null!=w&&(u++,e[s]=w);c=0;h=n.metadata.referenceCollections;k=0;for(p=h.length;k<p;k++){f=h[k];l=0;q=e[f];for(x in q)t=q[x],a=this.getRepository(t.entityType),w=null!=a?a.find(t.entityId):null,null!=w&&(l++,e[f][x]=w);l===e[f].length&&c++}u===n.numReferenceProperties()&&c===n.numReferenceCollections()?r.push(e.hydrated=!0):r.push(void 0)}return r}.call(this))):m.push(void 0);return m};b=a}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__references__reference_property=function(){null===b&&(b=function(b,a){this.entityClass=b;this.entityId=a});return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__repositories__entity_metadata=function(){if(null===b){var a;a=require("scribe/references/reference_property");var d=function(){this.klass=null;this.properties=[];this.references=[];this.referenceCollections=[]},g;d.prototype.buildFromInstance=function(b){var a,c,e;this.klass=b.constructor;e=[];for(a in b)c=b[a],c instanceof Array&&0<c.length&&g(c[0])?e.push(this.referenceCollections.push(a)):g(c)?e.push(this.references.push(a)):e.push(this.properties.push(a));
return e};d.prototype.hasReferences=function(){return null!==this.klass?0<this.references.length||0<this.referenceCollections.length:null};g=function(b){return b instanceof a};b=d}return b};window.modules=a})();
(function(){var a=window.modules||[],b=null;a.scribe__repositories__entity_repository=function(){if(null===b){var a;a=require("scribe/repositories/entity_metadata");var d=function(){this.entityList=[];this.metadata=new a},g;d.prototype.canHandle=function(a){return null===this.metadata.klass?!1:a instanceof this.metadata.klass||this.metadata.klass===a||this.metadata.klass.name===a};d.prototype.add=function(a){null===this.metadata.klass&&this.metadata.buildFromInstance(a);return this.entityList.push(a)};
d.prototype.remove=function(a){return this.entityList.splice(this.entityList.indexOf(a),1)};d.prototype.find=function(a){var b,c,e,d;d=this.entityList;c=0;for(e=d.length;c<e;c++)if(b=d[c],b.id===a)return b;return null};d.prototype.findAll=function(){return this.entityList};d.prototype.findBy=function(a){var b,c,e,d,s;d=this.entityList;s=[];c=0;for(e=d.length;c<e;c++)b=d[c],g(b,a)&&s.push(b);return s};d.prototype.findOneBy=function(a){var b,c,e,d;d=this.entityList;c=0;for(e=d.length;c<e;c++)if(b=d[c],
g(b,a))return b;return null};d.prototype.numEntities=function(){return this.entityList.length};d.prototype.hasReferences=function(){return this.metadata.hasReferences()};d.prototype.numReferenceProperties=function(){return null!==this.metadata.klass?this.metadata.references.length:null};d.prototype.numReferenceCollections=function(){return null!==this.metadata.klass?this.metadata.referenceCollections.length:null};g=function(a,b){var c,d;for(c in b)if(d=b[c],a[c]!==d)return!1;return!0};b=d}return b};
window.modules=a})();(function(){var a=window.modules||[];window.require=function(b){b=b.replace(/\//g,"__");-1===b.indexOf("__")&&(b="__"+b);return null===a[b]?null:a[b]()}})();

