(function(){var b=window.modules||[],a=null;b.scribe__datastore=function(){if(null===a){var b,d;d=require("scribe/repositories/entity_repository");b=require("scribe/factory/entity_factory");var j=function(e){this.entityFactory=e;this.repos=[]};j.create=function(e){return new this(new b(e))};j.prototype.buildEntity=function(e,h,c){null==c&&(c=!0);this.getRepository(e).add(this.entityFactory.build(e,h));if(c)return this.rebuildReferences()};j.prototype.buildEntities=function(e,h,c){var g,a,d;null==
c&&(c=!0);a=0;for(d=h.length;a<d;a++)g=h[a],this.buildEntity(e,g,!1);if(c)return this.rebuildReferences()};j.prototype.rebuildReferences=function(){var e,h,c,a,d,b,s,x,t,j,f,p,n,l,m,w,k;w=this.repos;k=[];l=0;for(m=w.length;l<m;l++)n=w[l],0<n.numEntities()&&n.hasReferences()?(e=n.findAll(),k.push(function(){var l,k,u,w,q,m,y;y=[];l=0;for(u=e.length;l<u;l++)if(b=e[l],b.hydrated)y.push(void 0);else{p=0;q=n.metadata.references;k=0;for(w=q.length;k<w;k++)x=q[k],f=b[x],j=this.getRepository(f.entityClass),
s=null!=j?j.find(f.entityId):null,null!=s&&(p++,b[x]=s);d=0;q=n.metadata.referenceCollections;k=0;for(w=q.length;k<w;k++){c=q[k];a=0;m=b[c];for(t in m)f=m[t],h=this.getRepository(f.entityClass),s=null!=h?h.find(f.entityId):null,null!=s&&(a++,b[c][t]=s);a===b[c].length&&d++}p===n.numReferenceProperties()&&d===n.numReferenceCollections()?y.push(b.hydrated=!0):y.push(void 0)}return y}.call(this))):k.push(void 0);return k};j.prototype.getRepository=function(e){var a,c,g,b;b=this.repos;c=0;for(g=b.length;c<
g;c++)if(a=b[c],a.canHandle(e))return a;e=new d(e);this.repos.push(e);return e};j.prototype.find=function(e,a){return this.getRepository(e).find(a)};a=j}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__factory__auto_mapper=function(){if(null===a){var b;b=require("scribe/references/reference_property");var d=function(e){this.entityClass=e},j,e,h,c,g,A,r;d.prototype.canHandle=function(e){return e===this.entityClass.name};d.prototype.handle=function(e){var a;a=A.call(this,e);null!=this.buildEntity&&this.buildEntity(e,a);return a};A=function(a){var b,d,f;b=new this.entityClass(a.id);for(d in a)f=a[d],h(b,d)&&(g(f)?b[d]=j(f):c(f)?e(b,d,f):b[d]=f);
return b};h=function(a,e){return e in a&&!(a[e]instanceof Function)};g=function(a){return a instanceof Object&&"class"in a&&"id"in a&&!(a.id instanceof Array)};c=function(a){return a instanceof Object&&"class"in a&&("ids"in a||"id"in a&&a.id instanceof Array)};j=function(a){return new b(a["class"],a.id)};e=function(a,e,b){var c,d,h,g,f;c=r(e);d=b["class"];b="id"in b?b.id:b.ids;if(null!=a["addTo"+c]){f=[];e=0;for(g=b.length;e<g;e++)h=b[e],h=j({"class":d,id:h}),f.push(a["addTo"+c](h));return f}f=[];
c=0;for(g=b.length;c<g;c++)h=b[c],f.push(j({"class":d,id:h}));return a[e]=f};r=function(a){return""+a.charAt(0).toUpperCase()+a.slice(1)};a=d}return a};window.modules=b})();(function(){var b=window.modules||[],a=null;b.scribe__factory__entity_factory=function(){if(null===a){var b=function(a){this.mappers=a};b.prototype.build=function(a,b){var e,h,c,g;g=this.mappers;h=0;for(c=g.length;h<c;h++)if(e=g[h],e.canHandle(a))return e.handle(b);return null};a=b}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__factory__entity_mapper=function(){if(null===a){var b=function(){this.entityClass=null};b.prototype.canHandle=function(a){return a===this.entityClass};b.prototype.handle=function(a){return this.buildEntity(a)};b.prototype.buildEntity=function(){return console.log("You must override the buildEntity() function to create a data mapper.")};a=b}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__references__reference_builder=function(){if(null===a){var b=function(){};b.prototype.rebuildReferences=function(){var a,b,e,h,c,g,f,r,s,x,t,z,v,p,n,l,m;l=this.repos;m=[];p=0;for(n=l.length;p<n;p++)v=l[p],0<v.numEntities()&&v.hasReferences()?(a=v.findAll(),m.push(function(){var l,k,n,m,u,p,q;q=[];l=0;for(n=a.length;l<n;l++)if(g=a[l],g.hydrated)q.push(void 0);else{z=0;u=v.metadata.references;k=0;for(m=u.length;k<m;k++)r=u[k],t=g[r],x=this.getRepository(t.entityType),
f=null!=x?x.find(t.entityId):null,null!=f&&(z++,g[r]=f);c=0;u=v.metadata.referenceCollections;k=0;for(m=u.length;k<m;k++){e=u[k];h=0;p=g[e];for(s in p)t=p[s],b=this.getRepository(t.entityType),f=null!=b?b.find(t.entityId):null,null!=f&&(h++,g[e][s]=f);h===g[e].length&&c++}z===v.numReferenceProperties()&&c===v.numReferenceCollections()?q.push(g.hydrated=!0):q.push(void 0)}return q}.call(this))):m.push(void 0);return m};a=b}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__references__reference_property=function(){null===a&&(a=function(a,b){this.entityClass=a;this.entityId=b});return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__repositories__entity_metadata=function(){if(null===a){var b;b=require("scribe/references/reference_property");var d=function(){this.klass=null;this.properties=[];this.references=[];this.referenceCollections=[]},j;d.prototype.buildFromInstance=function(a){var b,c,g;this.klass=a.constructor;g=[];for(b in a)c=a[b],c instanceof Array&&0<c.length&&j(c[0])?g.push(this.referenceCollections.push(b)):j(c)?g.push(this.references.push(b)):g.push(this.properties.push(b));
return g};d.prototype.hasReferences=function(){return null!==this.klass?0<this.references.length||0<this.referenceCollections.length:null};j=function(a){return a instanceof b};a=d}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__repositories__entity_repository=function(){if(null===a){var b;b=require("scribe/repositories/entity_metadata");var d=function(){this.entityList=[];this.metadata=new b},j;d.prototype.canHandle=function(a){return null===this.metadata.klass?!1:this.metadata.klass===a||this.metadata.klass.name===a||a.constructor===this.metadata.klass};d.prototype.add=function(a){null===this.metadata.klass&&this.metadata.buildFromInstance(a);return this.entityList.push(a)};
d.prototype.remove=function(a){return this.entityList.splice(this.entityList.indexOf(a),1)};d.prototype.find=function(a){var b,c,g,d;d=this.entityList;c=0;for(g=d.length;c<g;c++)if(b=d[c],b.id===a)return b;return null};d.prototype.findAll=function(){return this.entityList};d.prototype.findBy=function(a){var b,c,d,f,r;f=this.entityList;r=[];c=0;for(d=f.length;c<d;c++)b=f[c],j(b,a)&&r.push(b);return r};d.prototype.findOneBy=function(a){var b,c,d,f;f=this.entityList;c=0;for(d=f.length;c<d;c++)if(b=f[c],
j(b,a))return b;return null};d.prototype.numEntities=function(){return this.entityList.length};d.prototype.hasReferences=function(){return this.metadata.hasReferences()};d.prototype.numReferenceProperties=function(){return null!==this.metadata.klass?this.metadata.references.length:null};d.prototype.numReferenceCollections=function(){return null!==this.metadata.klass?this.metadata.referenceCollections.length:null};j=function(a,b){var c,d;for(c in b)if(d=b[c],a[c]!==d)return!1;return!0};a=d}return a};
window.modules=b})();(function(){var b=window.modules||[];window.require=function(a){a=a.replace(/\//g,"__");-1===a.indexOf("__")&&(a="__"+a);return null===b[a]?null:b[a]()}})();

