(function(){var b=window.modules||[],a=null;b.scribe__datastore=function(){if(null===a){var b,d;d=require("scribe/repositories/entity_repository");b=require("scribe/factory/entity_factory");var e=function(f){this.entityFactory=f;this.repos=[]};e["default"]=function(f){return new this(new b(f))};e.prototype.buildEntity=function(f,k,c){null==c&&(c=!0);this.getRepository(f).add(this.entityFactory.build(f,k));if(c)return this.rebuildReferences()};e.prototype.buildEntities=function(f,k,c){var d,a,b;null==
c&&(c=!0);a=0;for(b=k.length;a<b;a++)d=k[a],this.buildEntity(f,d,!1);if(c)return this.rebuildReferences()};e.prototype.rebuildReferences=function(){var f,k,c,a,d,b,e,t,u,v,m,r,g,h,l,w,j;w=this.repos;j=[];h=0;for(l=w.length;h<l;h++)g=w[h],0<g.numEntities()&&g.hasReferences()?(f=g.findAll(),j.push(function(){var j,p,z,h,s,w,l;l=[];j=0;for(z=f.length;j<z;j++)if(b=f[j],b.hydrated)l.push(void 0);else{r=0;s=g.metadata.references;p=0;for(h=s.length;p<h;p++)t=s[p],m=b[t],v=this.getRepository(m.entityType),
e=null!=v?v.find(m.entityId):null,null!=e&&(r++,b[t]=e);d=0;s=g.metadata.referenceCollections;p=0;for(h=s.length;p<h;p++){c=s[p];a=0;w=b[c];for(u in w)m=w[u],k=this.getRepository(m.entityType),e=null!=k?k.find(m.entityId):null,null!=e&&(a++,b[c][u]=e);a===b[c].length&&d++}r===g.numReferenceProperties()&&d===g.numReferenceCollections()?l.push(b.hydrated=!0):l.push(void 0)}return l}.call(this))):j.push(void 0);return j};e.prototype.getRepository=function(f){var a,c,b,e;e=this.repos;c=0;for(b=e.length;c<
b;c++)if(a=e[c],a.canHandle(f))return a;f=new d(f);this.repos.push(f);return f};e.prototype.find=function(f,a){return this.getRepository(f).find(a)};a=e}return a};window.modules=b})();(function(){var b=window.modules||[],a=null;b.scribe__factory__entity_factory=function(){if(null===a){var b=function(a){this.mappers=a};b.prototype.build=function(a,b){var f,k,c,q;q=this.mappers;k=0;for(c=q.length;k<c;k++)if(f=q[k],f.canHandle(a))return f.handle(b);return null};a=b}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__factory__entity_mapper=function(){if(null===a){var b=function(){this.type=null};b.prototype.canHandle=function(a){return a===this.type};b.prototype.handle=function(a){a=this.buildEntity(a);a.entityType=this.type;return a};b.prototype.buildEntity=function(){return alert("You must override the buildEntity() function to create a data mapper.")};a=b}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__references__reference_builder=function(){if(null===a){var b=function(){};b.prototype.rebuildReferences=function(){var a,b,f,k,c,q,n,t,x,y,u,v,m,r,g,h,l;h=this.repos;l=[];r=0;for(g=h.length;r<g;r++)m=h[r],0<m.numEntities()&&m.hasReferences()?(a=m.findAll(),l.push(function(){var h,j,l,p,g,r,s;s=[];h=0;for(l=a.length;h<l;h++)if(q=a[h],q.hydrated)s.push(void 0);else{v=0;g=m.metadata.references;j=0;for(p=g.length;j<p;j++)t=g[j],u=q[t],y=this.getRepository(u.entityType),
n=null!=y?y.find(u.entityId):null,null!=n&&(v++,q[t]=n);c=0;g=m.metadata.referenceCollections;j=0;for(p=g.length;j<p;j++){f=g[j];k=0;r=q[f];for(x in r)u=r[x],b=this.getRepository(u.entityType),n=null!=b?b.find(u.entityId):null,null!=n&&(k++,q[f][x]=n);k===q[f].length&&c++}v===m.numReferenceProperties()&&c===m.numReferenceCollections()?s.push(q.hydrated=!0):s.push(void 0)}return s}.call(this))):l.push(void 0);return l};a=b}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__references__reference_property=function(){null===a&&(a=function(a,b){this.entityType=a;this.entityId=b});return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__repositories__entity_metadata=function(){if(null===a){var b;b=require("scribe/references/reference_property");var d=function(){this.isBuilt=!1;this.type="";this.properties=[];this.references=[];this.referenceCollections=[]},e;d.prototype.buildFromInstance=function(a){var b,c;this.type=a.entityType;for(b in a)c=a[b],c instanceof Array&&0<c.length&&e(c[0])?this.referenceCollections.push(b):e(c)?this.references.push(b):this.properties.push(b);return this.isBuilt=
!0};d.prototype.hasReferences=function(){return this.isBuilt?0<this.references.length||0<this.referenceCollections.length:null};e=function(a){return a instanceof b};a=d}return a};window.modules=b})();
(function(){var b=window.modules||[],a=null;b.scribe__repositories__entity_repository=function(){if(null===a){var b;b=require("scribe/repositories/entity_metadata");var d=function(a){this.type=a;this.entityList=[];this.metadata=new b},e;d.prototype.canHandle=function(a){return this.type===a};d.prototype.add=function(a){this.metadata.isBuilt||this.metadata.buildFromInstance(a);return this.entityList.push(a)};d.prototype.remove=function(a){return this.entityList.splice(this.entityList.indexOf(a),1)};
d.prototype.find=function(a){var b,c,d,e;e=this.entityList;c=0;for(d=e.length;c<d;c++)if(b=e[c],b.id===a)return b;return null};d.prototype.findAll=function(){return this.entityList};d.prototype.findBy=function(a){var b,c,d,n,t;n=this.entityList;t=[];c=0;for(d=n.length;c<d;c++)b=n[c],e(b,a)&&t.push(b);return t};d.prototype.findOneBy=function(a){var b,c,d,n;n=this.entityList;c=0;for(d=n.length;c<d;c++)if(b=n[c],e(b,a))return b;return null};d.prototype.numEntities=function(){return this.entityList.length};
d.prototype.hasReferences=function(){return this.metadata.hasReferences()};d.prototype.numReferenceProperties=function(){return this.metadata.isBuilt?this.metadata.references.length:null};d.prototype.numReferenceCollections=function(){return this.metadata.isBuilt?this.metadata.referenceCollections.length:null};e=function(a,b){var c,d;c=!0;for(d in b)c=c?a[d]===b[d]:!1;return c};a=d}return a};window.modules=b})();
(function(){var b=window.modules||[];window.require=function(a){a=a.replace(/\//g,"__");-1===a.indexOf("__")&&(a="__"+a);return null===b[a]?null:b[a]()}})();

